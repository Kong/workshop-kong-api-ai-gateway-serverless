<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="To deploy the OpenTelemetry Collector and to get better control over it, we‚Äôre going to do it through the OpenTelemetry Kubernetes Operator. In fact, the collector is also capable of auto-instrument applications and services using OpenTelemetry instrumentation libraries.
Installing Cert-Manager The OpenTelemetry Operator requires Cert-Manager to be installed in your Kubernetes cluster. The Cert-Manager can then issue certificates to be used by the communication between the Kubernetes API Server and the existing webhook included in the operator.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="OTel Collector Installation :: API Management with Kong Konnect">
    <meta name="twitter:description" content="To deploy the OpenTelemetry Collector and to get better control over it, we‚Äôre going to do it through the OpenTelemetry Kubernetes Operator. In fact, the collector is also capable of auto-instrument applications and services using OpenTelemetry instrumentation libraries.
Installing Cert-Manager The OpenTelemetry Operator requires Cert-Manager to be installed in your Kubernetes cluster. The Cert-Manager can then issue certificates to be used by the communication between the Kubernetes API Server and the existing webhook included in the operator.">
    <meta property="og:url" content="http://localhost:1313/20-observability/230-otel_collector_installation-copy/index.html">
    <meta property="og:site_name" content="API Management with Kong Konnect">
    <meta property="og:title" content="OTel Collector Installation :: API Management with Kong Konnect">
    <meta property="og:description" content="To deploy the OpenTelemetry Collector and to get better control over it, we‚Äôre going to do it through the OpenTelemetry Kubernetes Operator. In fact, the collector is also capable of auto-instrument applications and services using OpenTelemetry instrumentation libraries.
Installing Cert-Manager The OpenTelemetry Operator requires Cert-Manager to be installed in your Kubernetes cluster. The Cert-Manager can then issue certificates to be used by the communication between the Kubernetes API Server and the existing webhook included in the operator.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Observability">
    <meta itemprop="name" content="OTel Collector Installation :: API Management with Kong Konnect">
    <meta itemprop="description" content="To deploy the OpenTelemetry Collector and to get better control over it, we‚Äôre going to do it through the OpenTelemetry Kubernetes Operator. In fact, the collector is also capable of auto-instrument applications and services using OpenTelemetry instrumentation libraries.
Installing Cert-Manager The OpenTelemetry Operator requires Cert-Manager to be installed in your Kubernetes cluster. The Cert-Manager can then issue certificates to be used by the communication between the Kubernetes API Server and the existing webhook included in the operator.">
    <meta itemprop="wordCount" content="722">
    <title>OTel Collector Installation :: API Management with Kong Konnect</title>
    <link href="/css/auto-complete/auto-complete.min.css?1755094189" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1755094189" defer></script>
    <script src="/js/search-lunr.js?1755094189" defer></script>
    <script src="/js/search.js?1755094189" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1755094189";
    </script>
    <script src="/js/lunr/lunr.min.js?1755094189" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1755094189" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1755094189" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1755094189" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1755094189" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1755094189" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1755094189" rel="stylesheet">
    <link href="/css/theme.css?1755094189" rel="stylesheet">
    <link href="/css/format-html.css?1755094189" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/20-observability\/230-otel_collector_installation-copy\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'blue' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/20-observability/230-otel_collector_installation-copy/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/index.html"><span itemprop="name">API Management with Kong Konnect</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/20-observability/index.html"><span itemprop="name">Observability</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">OTel Collector Installation</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/20-observability/220-reference_architecture/index.html" title="Reference Architecture (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/20-observability/230-otel_collector_installation/index.html" title="OTel Collector Installation (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 20-observability" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="otel-collector-installation">OTel Collector Installation</h1>

<p>To deploy the OpenTelemetry Collector and to get better control over it, we&rsquo;re going to do it through the OpenTelemetry Kubernetes Operator. In fact, the collector is also capable of auto-instrument applications and services using OpenTelemetry instrumentation libraries.</p>
<h4 id="installing-cert-manager">Installing Cert-Manager</h4>
<p>The OpenTelemetry Operator requires <a href="https://cert-manager.io/" rel="external" target="_blank">Cert-Manager</a> to be installed in your Kubernetes cluster. The Cert-Manager can then issue certificates to be used by the communication between the Kubernetes API Server and the existing webhook included in the operator.</p>
<p>Use the <a href="https://cert-manager.io/docs/installation/helm/" rel="external" target="_blank">Cert-Manager Helm Charts</a> to get it installed.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>helm install \
  cert-manager oci://quay.io/jetstack/charts/cert-manager \
  --version v1.18.2 \
  --namespace cert-manager \
  --create-namespace \
  --set crds.enabled=true</code></pre></div>
<h4 id="installing-opentelemetry-operator">Installing OpenTelemetry Operator</h4>
<p>Now we&rsquo;re going to use the <a href="https://github.com/open-telemetry/opentelemetry-helm-charts" rel="external" target="_blank">OpenTelemetry Helm Charts</a> to install it. Add its repo:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts</code></pre></div>
<p>Install the operator:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>helm install opentelemetry-operator open-telemetry/opentelemetry-operator \
  --namespace opentelemetry-operator-system \
  --create-namespace \
  --set manager.collectorImage.repository=otel/opentelemetry-collector-k8s \
  --set admissionWebhooks.certManager.enabled=true</code></pre></div>
<p>The ‚ÄúadmissionWebhooks‚Äù parameter asks Cert-Manager to generate a self-signed certificate. The operator installs some new CRDs used to create a new OpenTelemetry Collector. You can check them out with:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>kubectl describe crd opentelemetrycollectors.opentelemetry.io
kubectl describe crd instrumentations.opentelemetry.io</code></pre></div>
<h4 id="opentelemetry-collector-instantiation">OpenTelemetry Collector instantiation</h4>
<p>With the operator in place, we can use the new CRD to deploy our OpenTelemetry Collector.</p>
<h5 id="create-a-collector-declaration">Create a collector declaration</h5>
<p>To get started we&rsquo;re going to manage Traces first. Later on, we&rsquo;ll enhance the collector to process both Metrics and Logs. Here&rsquo;s the declaration:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cat &gt; otelcollector.yaml &lt;&lt; &#39;EOF&#39;
apiVersion: opentelemetry.io/v1beta1
kind: OpenTelemetryCollector
metadata:
  name: collector-kong
  namespace: opentelemetry-operator-system
spec:
  image: otel/opentelemetry-collector-contrib:0.132.2
  mode: deployment
  env:
  - name: DT_ENDPOINT
    valueFrom:
      secretKeyRef:
        key: dt-endpoint
        name: dynatrace-endpoint
  - name: DT_API_TOKEN
    valueFrom:
      secretKeyRef:
        key: dt-access-token
        name: dynatrace-access-token
  - name: KONG_DEPLOYMENT_NAME
    value: kong-ecommerce-deployment
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318

    exporters:
      otlphttp:
        endpoint: &#34;${env:DT_ENDPOINT}&#34;
        headers:
          Authorization: &#34;Api-Token ${env:DT_API_TOKEN}&#34;
      debug:
        verbosity: detailed

    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [attributes]
          exporters: [otlphttp]
EOF</code></pre></div>
<p>The declaration has critical parameters defined:</p>
<p>image: it refers to the Dynatrace OTel Collector distribution.
mode: deployment. The collector can be deployed in 4 different modes: ‚ÄúDeployment‚Äù, ‚ÄúDaemonSet‚Äù, ‚ÄúStatefulSet‚Äù and ‚ÄúSidecar‚Äù. For better control of the Controller, we&rsquo;ve chosen regular Kubernetes Deployment mode. Please, refer to the Kubernetes documentation to learn more about them.
The collector requires the Dynatrace Endpoint and API Token to connect. They are stored as Kubernetes secrets and are referred to in the ‚Äúenv‚Äù section.
The config section has the collector components (receivers and exporters) as well as the ‚Äúservice‚Äù section defining the Pipeline.</p>
<p>The ‚Äúreceivers‚Äù section tells us the collector will be listening to ports 4317 and 4318 and will be receiving data over ‚Äúgrpc‚Äù and ‚Äúhttp‚Äù.
The ‚Äúexporters‚Äù section used the endpoint and the API Token to send data to Dynatrace.
The ‚Äúservice‚Äù section defines the Pipeline. Note we have a simple ‚Äúattributes processor‚Äù defined setting the ‚Äúkong.deployment.name‚Äù attribute as ‚Äúkong-ecommerce-deployment‚Äù to be used by the Dynatrace dashboards.
Dynatrace Secrets
Before instantiating the collector we need to create the Kubernetes secrets with the Dynatrace endpoint and API Token. The endpoint refers to your Dynatrace tenant:</p>
<p>kubectl create secret generic dynatrace-endpoint -n opentelemetry-operator-system &ndash;from-literal=dt-endpoint=&lsquo;https://&lt;your_Dynatrace_tenant&gt;.live.dynatrace.com/api/v2/otlp&rsquo;
And create another secret for the Dynatrace API Token. The Token needs to be created with the ‚ÄúIngest metrics‚Äù scope. Since we&rsquo;re going to manage Logs and Traces, add the ‚ÄúIngest logs‚Äù and ‚ÄúIngest OpenTelemetry traces‚Äù scopes as well. Check the Dynatrace documentation to learn how to issue API Tokens.</p>
<p>kubectl create secret generic dynatrace-access-token -n opentelemetry-operator-system &ndash;from-literal=dt-access-token=&rsquo;&lt;your_API_TOKEN&gt;'
In case you want to decode your secret, use the base64 command. For example:</p>
<p>kubectl get secret dynatrace-endpoint -n opentelemetry-operator-system -o json | jq -r &lsquo;.data.&ldquo;dt-endpoint&rdquo;&rsquo; | base64 &ndash;decode
Deploy the collector
You can instantiate the collector by simply submitting the declaration:</p>
<p>kubectl apply -f otelcollector-dynatrace-traces.yaml
If you want to destroy it run:</p>
<p>kubectl delete opentelemetrycollector collector-kong -n opentelemetry-operator-system
Check the collector&rsquo;s log with:</p>
<p>kubectl logs -f $(kubectl get pod -n opentelemetry-operator-system -o json | jq &lsquo;.items[].metadata | select(.name | startswith(&ldquo;collector&rdquo;))&rsquo; | jq -r &lsquo;.name&rsquo;) -n opentelemetry-operator-system
Based on the declaration, the deployment creates a Kubernetes service named ‚Äúcollector-kong-collector‚Äù listening to ports 4317 and 4318. That means that any application, including Kong Data Plane, should refer to the OTel Collector&rsquo;s Kubernetes FQDN (e.g., <a href="http://collector-kong-collector.opentelemetry-operator-system.svc.cluster.local:4318/v1/traces" rel="external" target="_blank">http://collector-kong-collector.opentelemetry-operator-system.svc.cluster.local:4318/v1/traces</a>) to send data to the collector. The ‚Äú/v1/traces‚Äù path is the default the collector uses to handle requests with trace data.</p>
<p>% kubectl get service collector-kong-collector -n opentelemetry-operator-system
NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
collector-kong-collector   ClusterIP   10.100.23.139   <!-- raw HTML omitted -->        4317/TCP,4318/TCP   29m
6</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">API Management with Kong Konnect</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/index.html"><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/10-prerequisites/index.html"><a class="padding" href="/10-prerequisites/index.html">Prerequisites</a><ul id="R-subsections-cdc0df3ea972ffd3a9c45dea986dc8ab" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/architecture/index.html"><a class="padding" href="/architecture/index.html">Kong Konnect Architectural Overview</a></li>
            <li class="" data-nav-id="/11-konnect-setup/index.html"><a class="padding" href="/11-konnect-setup/index.html">Konnect Setup</a><ul id="R-subsections-fd457d3a7fac9b2f9cefa5c6c0dae1e7" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/12-api-gateway/index.html"><a class="padding" href="/12-api-gateway/index.html">Kong API Gateway</a><ul id="R-subsections-edeba57bcdf65a92672ecb9c5ed9177f" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/16-ai-gateway/index.html"><a class="padding" href="/16-ai-gateway/index.html">Kong AI Gateway</a><ul id="R-subsections-2f2bf218915a29de3a144cfa324a5fc4" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/20-observability/index.html"><a class="padding" href="/20-observability/index.html">Observability</a><ul id="R-subsections-3829b558aa20efb46efd7e331dc0c9e9" class="collapsible-menu">
            <li class="alwaysopen " data-nav-id="/20-observability/17-use-cases/index.html"><a class="padding" href="/20-observability/17-use-cases/index.html">Use Cases</a><ul id="R-subsections-a063a860f8407145f89ac2776a5f4acb" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/20-observability/210-introduction/index.html"><a class="padding" href="/20-observability/210-introduction/index.html">OpenTelemetry Introduction</a></li>
            <li class="" data-nav-id="/20-observability/220-reference_architecture/index.html"><a class="padding" href="/20-observability/220-reference_architecture/index.html">Reference Architecture</a></li>
            <li class="active " data-nav-id="/20-observability/230-otel_collector_installation-copy/index.html"><a class="padding" href="/20-observability/230-otel_collector_installation-copy/index.html">OTel Collector Installation</a></li>
            <li class="" data-nav-id="/20-observability/230-otel_collector_installation/index.html"><a class="padding" href="/20-observability/230-otel_collector_installation/index.html">OTel Collector Installation</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1755094189" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1755094189" defer></script>
    <script src="/js/theme.js?1755094189" defer></script>
  </body>
</html>
