---
title : "APIOps and decK"
weight : 140
---

## Concept

APIOps applies DevOps principles (automation, version control, CI/CD) to API lifecycle management. Here's a diagrama describing an APIOps lifecycle with Kong Technologies.


![apiops](/static/images/apiops.png)

There are 3 main steps used to deliver APIs to Kong Gateway. These workflows are completed in sequence, with administrator approval between each step. Completion of final workflow results in a deployed API to Kong Konnect.

* OpenAPI to Kong: This step takes an OpenAPI specification and converts it to a decK file that can be used by Kong Gateway. Additionally, service specific patches are applied to the decK file allowing administrators to set overrides for specific APIs.
* Stage decK changes: This step takes the decK file generated by the OpenAPI to Kong step and compares it to the current state of the Kong Gateway. It generates a diff and stages the changes as a PR.
* decK sync: This step is triggered by the merging of deck configuration files to the main branch (by the previous workflow PR approval). The step triggers a ``deck gateway sync`` command on the configuration files and applies the changes to Kong Gateway.




## decK and APIOps

With Kong Konnect and **decK**, APIs can be treated as code â€” versioned, tested, and deployed through pipelines.

In this section we are going to implement a simple flow starting with the OpenAPI specification, converting it to a Kong declaration and applying to the Control Plane.


### Download the OpenAPI specification

Download the [kong-air-apis.yaml](/code/kong-air-apis.yaml) OpenAPI spec. The spec defines routes to consume APIs exposed by the [**KongAir API Server**](https://api.kong-air.com/routes)



### Convert the OpenAPI spec into Kong configuration

```
deck file openapi2kong --spec ./kong-air-apis.yaml -o kong.yaml
```



### Add tags for traceability

```
deck file add-tags kong-konnect-workshop -s kong.yaml -o kong.yaml
```



### Merge plugins configuration

Create a plugin configuration file

```
cat > plugins.yaml << 'EOF'
_format_version: "3.0"
_konnect:
   control_plane_name: serverless-default
_info:
   select_tags:
   - kong-konnect-workshop
plugins:
- name: proxy-cache
  enabled: true
  config:
   strategy: memory
   cache_ttl: 30
EOF
```


Merge the files

```
deck file merge ./kong.yaml ./plugins.yaml -o kong.yaml
```



### Sync with Konnect

```
deck gateway sync kong.yaml \
    --konnect-addr "https://us.api.konghq.com" \
    --konnect-control-plane-name serverless-default \
    --konnect-token $PAT \
    --select-tag kong-konnect-workshop
```

Expected output:

```
creating service routes-service
creating route routes-service_get-route
creating route routes-service_health-check
creating route routes-service_get-routes
creating plugin proxy-cache (global)
Summary:
  Created: 5
  Updated: 0
  Deleted: 0
```


### Consume a Kong Route

```
curl -s $DATA_PLANE_URL/routes | jq
```


## CI tool integration

As a best practice, for a CI tool integration, these steps should be included in a script and integrated into a CI tool of your choice (e.g., Jenkins, GitHub Actions, GitLab CI).

The script should be triggered the script on every code push or pull request.

Lastly, you should store your Konnect token as secrets.
   

### Key Takeaways

- Treat APIs as code: store OpenAPI + Kong configs in version control.
- Automate API deployment with decK for repeatability and reliability.
- CI/CD tools can run Bash scripts to enable APIOps in real-world projects.

### Next Steps

- Extend the script with tests (linting, validation, diff before sync).
- Explore GitHub Actions or Jenkins examples for pipeline automation.
- Move towards full GitOps by integrating declarative API configs with source control workflows.



## Kong Konnect Automation Options

Besides decK, Kong offers other options to implement APIOps automation:

* [Terraform](https://developer.konghq.com/terraform/): Used for both Konnect platform and gateway configuration
* [Konnect APIs](https://developer.konghq.com/api/): Used for both Konnect platform and gateway configuration


![apiops_automation](/static/images/apiops_automation.png)


## Reset your Control Plane

```
deck gateway reset --konnect-control-plane-name serverless-default --konnect-token $PAT -f
```
